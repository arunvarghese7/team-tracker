<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Command | Team Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              executive: {
                950: '#050507', // Deepest background
                900: '#0f0f13', // Card background
                800: '#27272a', // Light Borders
                700: '#3f3f46', // Hover states
                gold: '#FFC300',
                goldDim: '#B38F00',
                blue: '#3b82f6',
                green: '#10b981',
                red: '#ef4444',
              }
            }
          }
        }
      }
    </script>

    <style>
      body {
        background-color: #050507;
        color: #e4e4e7;
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f0f13; 
      }
      ::-webkit-scrollbar-thumb {
        background: #27272a; 
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #3f3f46; 
      }
      
      .glass-panel {
        background: rgba(15, 15, 19, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* Loader Animation */
      .loader {
        border: 2px solid #27272a;
        border-top: 2px solid #FFC300;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col">

    <nav class="glass-panel sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-2 h-8 bg-executive-gold rounded-full"></div>
                <h1 class="text-xl font-bold tracking-tight text-white">COMMAND <span class="text-gray-500 font-light">CENTER</span></h1>
            </div>
            <div class="flex items-center gap-4">
                <span id="lastUpdate" class="text-xs text-gray-500 font-mono">Synced: --:--</span>
                <button id="refreshBtn" class="flex items-center gap-2 px-4 py-2 bg-executive-900 border border-executive-800 rounded-lg text-sm font-medium hover:bg-executive-800 hover:text-white transition-all text-gray-400">
                    <span id="refreshIcon">‚Üª</span> Refresh
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-1 max-w-7xl mx-auto px-6 py-10 w-full space-y-10">

        <div class="flex flex-col md:flex-row justify-between items-end gap-6 border-b border-white/5 pb-10">
            <div>
                <h2 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-2">Team Performance</h2>
                <p class="text-gray-400">Real-time operational intelligence and metric tracking.</p>
            </div>
            
            <div class="bg-executive-900 p-1 rounded-lg border border-executive-800 flex">
                <button id="trackerToggle" onclick="dashboard.switchDataSource('tracker')" class="px-6 py-2 rounded-md text-sm font-medium transition-all text-gray-400 hover:text-white">
                    Team Tracker
                </button>
                <button id="freshserviceToggle" onclick="dashboard.switchDataSource('freshservice')" class="px-6 py-2 rounded-md text-sm font-medium transition-all text-gray-400 hover:text-white">
                    Freshservice
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-1 space-y-4">
                <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Timeframe</label>
                <div class="flex flex-col gap-2">
                    <input type="date" id="startDate" class="bg-executive-900 border border-executive-800 rounded-lg px-4 py-2 text-sm text-gray-300 focus:outline-none focus:border-executive-gold focus:ring-1 focus:ring-executive-gold transition-colors">
                    <input type="date" id="endDate" class="bg-executive-900 border border-executive-800 rounded-lg px-4 py-2 text-sm text-gray-300 focus:outline-none focus:border-executive-gold focus:ring-1 focus:ring-executive-gold transition-colors">
                    <div class="flex justify-between mt-2">
                        <button onclick="dashboard.clearAllFilters()" class="text-xs text-gray-500 hover:text-white underline decoration-dotted">Clear Filters</button>
                        <button id="exportBtn" class="text-xs text-executive-gold hover:text-executive-goldDim font-medium flex items-center gap-1">
                            ‚¨á Export CSV
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3 space-y-4">
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label id="engineerFilterLabel" class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Personnel</label>
                        <span class="text-[10px] text-gray-600 bg-executive-900 px-2 py-0.5 rounded border border-executive-800">Multi-select</span>
                    </div>
                    <div id="engineerFilters" class="flex flex-wrap gap-2 max-h-24 overflow-y-auto pr-2 custom-scrollbar">
                        </div>
                </div>
                <div>
                    <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 block">Status</label>
                    <div id="statusFilters" class="flex flex-wrap gap-2">
                        </div>
                </div>
            </div>
        </div>

        <div id="statsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            </div>

        <div class="space-y-6">
            <h3 id="engineerCardsTitle" class="text-xl font-bold text-white border-l-4 border-executive-gold pl-4">Performance Metrics</h3>
            <div id="engineerCards" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                </div>
        </div>

        <div class="space-y-6">
             <div class="flex justify-between items-center">
                <h3 id="tableTitle" class="text-xl font-bold text-white border-l-4 border-executive-blue pl-4">Activity Log</h3>
                <div class="text-sm text-gray-500" id="recordCount"></div>
            </div>
            
            <div class="bg-executive-900 border border-executive-800 rounded-xl overflow-hidden shadow-2xl">
                <div class="overflow-x-auto">
                    <div id="tableContent">
                        </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="border-t border-white/5 mt-auto py-8">
        <div class="max-w-7xl mx-auto px-6 text-center text-gray-600 text-sm">
            <p>&copy; 2024 IT Operations Dashboard. Internal Use Only.</p>
        </div>
    </footer>

    <script>
        const CONFIG = {
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbz1jIz73VKcat6GmkqovmqtXHyago4bimxxeaVWekniYU_lowq-e4t9FV1r2PSUqziIKw/exec', // Replace with your actual URL
            API_KEY: '98415623-a1d1-4045-84d3-c3e67fa687af',        // Replace with your actual Key
            REFRESH_INTERVAL: 300000,
            ENABLE_DEMO: false, // Set to false to use live API
            ORG_NAME: 'Your Organization'
        };

        const DEMO_DATA_TRACKER = [
            { 'Task': 'API Integration', 'Sub-Task': 'User Auth', 'Engineer': 'Alice Johnson', 'Status': 'Completed', 'Start Date': '2024-10-01', 'Closure Date': '2024-10-15', 'Blocker/Dependency': '' },
            { 'Task': 'API Integration', 'Sub-Task': 'Payment', 'Engineer': 'Bob Smith', 'Status': 'In Progress', 'Start Date': '2024-10-10', 'Closure Date': '', 'Blocker/Dependency': '' },
            { 'Task': 'Database Migration', 'Sub-Task': 'Schema', 'Engineer': 'Carol Davis', 'Status': 'Completed', 'Start Date': '2024-09-15', 'Closure Date': '2024-09-30', 'Blocker/Dependency': '' },
            { 'Task': 'Database Migration', 'Sub-Task': 'Data Transfer', 'Engineer': 'David Lee', 'Status': 'Blocked', 'Start Date': '2024-10-01', 'Closure Date': '', 'Blocker/Dependency': 'Waiting for approval' },
            { 'Task': 'Frontend Redesign', 'Sub-Task': 'Homepage', 'Engineer': 'Emma Wilson', 'Status': 'Completed', 'Start Date': '2024-11-01', 'Closure Date': '2024-11-10', 'Blocker/Dependency': '' },
            { 'Task': 'Frontend Redesign', 'Sub-Task': 'Dashboard', 'Engineer': 'Frank Brown', 'Status': 'In Progress', 'Start Date': '2024-11-05', 'Closure Date': '', 'Blocker/Dependency': '' },
        ];
        
        const DEMO_DATA_FRESHSERVICE = [
            { 'ID': 1001, 'Type': 'Incident', 'Status': 'Resolved', 'Priority': 'High', 'Subject': 'Network outage in building A', 'Agent Name': 'Alice Johnson', 'Created Date': '2024-11-20', 'Resolved Date': '2024-11-20', 'Closed Date': '2024-11-21' },
            { 'ID': 1002, 'Type': 'Service Request', 'Status': 'Open', 'Priority': 'Low', 'Subject': 'Request new laptop for Jane', 'Agent Name': 'Carol Davis', 'Created Date': '2024-11-27', 'Resolved Date': '', 'Closed Date': '' },
            { 'ID': 1003, 'Type': 'Incident', 'Status': 'Pending', 'Priority': 'Medium', 'Subject': 'Printer in HR broken', 'Agent Name': 'Bob Smith', 'Created Date': '2024-11-28', 'Resolved Date': '', 'Closed Date': '' },
            { 'ID': 1004, 'Type': 'Service Request', 'Status': 'Closed', 'Priority': 'High', 'Subject': 'Software installation request', 'Agent Name': 'Alice Johnson', 'Created Date': '2024-11-15', 'Resolved Date': '2024-11-16', 'Closed Date': '2024-11-16' },
            { 'ID': 1005, 'Type': 'Problem', 'Status': 'On Hold', 'Priority': 'Medium', 'Subject': 'Server license issue', 'Agent Name': 'David Lee', 'Created Date': '2024-10-10', 'Resolved Date': '', 'Closed Date': '' },
            { 'ID': 1006, 'Type': 'Incident', 'Status': 'Open', 'Priority': 'High', 'Subject': 'Critical website error', 'Agent Name': 'David Lee', 'Created Date': '2024-11-28', 'Resolved Date': '', 'Closed Date': '' },
        ];

        class Dashboard {
            constructor() {
                this.data = [];
                this.filteredData = [];
                this.metadata = { engineers: [], statuses: [] };
                this.filters = {
                    engineers: [],
                    statuses: [],
                    dateRange: { start: '', end: '' }
                };
                this.currentSource = 'tracker'; 
                this.init();
            }

            async init() {
                await this.switchDataSource(this.currentSource, false); 
                this.render();
                setInterval(() => this.loadData(), CONFIG.REFRESH_INTERVAL);
            }

            /**
             * Helper to retrieve fields safely regardless of API key casing (e.g. "Agent Name" vs "agent_name")
             */
            getFieldValue(item, fieldType) {
                if (!item) return '';
                
                // Possible variations for Agent/Engineer
                if (fieldType === 'engineer') {
                    return item['Engineer'] || item['engineer'] || item['Agent Name'] || item['agent_name'] || item['agent'] || item['Responder'] || 'Unassigned';
                }
                
                // Possible variations for Date
                if (fieldType === 'date') {
                    return item['Start Date'] || item['start_date'] || item['Created Date'] || item['created_at'] || '';
                }

                return '';
            }

            async switchDataSource(source, reload = true) {
                this.currentSource = source;
                
                // Styling the Toggles
                const activeClass = "bg-executive-gold text-executive-950 font-bold shadow-lg";
                const inactiveClass = "text-gray-400 hover:text-white";

                const trackerBtn = document.getElementById('trackerToggle');
                const fsBtn = document.getElementById('freshserviceToggle');

                // Reset classes
                trackerBtn.className = "px-6 py-2 rounded-md text-sm transition-all duration-300 " + (source === 'tracker' ? activeClass : inactiveClass);
                fsBtn.className = "px-6 py-2 rounded-md text-sm transition-all duration-300 " + (source === 'freshservice' ? activeClass : inactiveClass);
                
                // Update Titles
                document.getElementById('engineerCardsTitle').textContent = source === 'tracker' ? 'Engineer Output' : 'Agent Resolution Stats';
                document.getElementById('tableTitle').textContent = source === 'tracker' ? 'Engineering Tasks' : 'Helpdesk Tickets';
                document.getElementById('engineerFilterLabel').textContent = source === 'tracker' ? 'ENGINEERS' : 'AGENTS';

                if (reload) {
                    this.filters = { engineers: [], statuses: [], dateRange: { start: '', end: '' } };
                    document.getElementById('startDate').value = '';
                    document.getElementById('endDate').value = '';
                    await this.loadData();
                }
            }

            async loadData() {
                const refreshIcon = document.getElementById('refreshIcon');
                refreshIcon.classList.add('animate-spin');

                try {
                    if (CONFIG.ENABLE_DEMO) {
                        // Simulate network delay
                        await new Promise(r => setTimeout(r, 600)); 
                        this.data = this.currentSource === 'tracker' ? DEMO_DATA_TRACKER : DEMO_DATA_FRESHSERVICE;
                        
                        const engineerList = this.data.map(d => this.getFieldValue(d, 'engineer')).filter(n => n && n !== 'Unassigned');
                        const statusList = this.data.map(d => d.Status).filter(Boolean);
                        
                        this.metadata = {
                            engineers: [...new Set(engineerList)].sort(),
                            statuses: [...new Set(statusList)].sort()
                        };
                    } else {
                        // ... Live API Fetch Logic (Same as before) ...
                         if (!CONFIG.APPS_SCRIPT_URL || !CONFIG.API_KEY) {
                            throw new Error('Missing CONFIG: APPS_SCRIPT_URL or API_KEY');
                        }
                        const [dataRes, metaRes] = await Promise.all([
                            fetch(`${CONFIG.APPS_SCRIPT_URL}?action=getData&source=${this.currentSource}&key=${CONFIG.API_KEY}`),
                            fetch(`${CONFIG.APPS_SCRIPT_URL}?action=getMetadata&source=${this.currentSource}&key=${CONFIG.API_KEY}`)
                        ]);
                        const data = await dataRes.json();
                        const meta = await metaRes.json();
                        if (!data.success) throw new Error(data.message);
                        if (!meta.success) throw new Error(meta.message);
                        this.data = data.data;
                        this.metadata = meta.data;
                    }

                    this.applyFilters();
                    this.render();
                    document.getElementById('lastUpdate').textContent = 'Synced: ' + new Date().toLocaleTimeString();
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error loading data: ' + error.message);
                } finally {
                    refreshIcon.classList.remove('animate-spin');
                }
            }

            applyFilters() {
                let filtered = [...this.data];

                if (this.filters.engineers.length > 0) {
                    filtered = filtered.filter(item => this.filters.engineers.includes(this.getFieldValue(item, 'engineer')));
                }

                if (this.filters.statuses.length > 0) {
                    filtered = filtered.filter(item => this.filters.statuses.includes(item.Status));
                }

                if (this.filters.dateRange.start && this.filters.dateRange.end) {
                    const start = new Date(this.filters.dateRange.start);
                    const end = new Date(this.filters.dateRange.end);
                    
                    filtered = filtered.filter(item => {
                        const dateStr = this.getFieldValue(item, 'date');
                        if (!dateStr) return false;
                        const date = new Date(dateStr);
                        return date >= start && date <= end; 
                    });
                }

                this.filteredData = filtered;
            }

            toggleEngineerFilter(engineer) {
                const idx = this.filters.engineers.indexOf(engineer);
                if (idx > -1) this.filters.engineers.splice(idx, 1);
                else this.filters.engineers.push(engineer);
                this.applyFilters();
                this.render();
            }

            toggleStatusFilter(status) {
                const idx = this.filters.statuses.indexOf(status);
                if (idx > -1) this.filters.statuses.splice(idx, 1);
                else this.filters.statuses.push(status);
                this.applyFilters();
                this.render();
            }

            clearAllFilters() {
                this.filters = { engineers: [], statuses: [], dateRange: { start: '', end: '' } };
                document.getElementById('startDate').value = '';
                document.getElementById('endDate').value = '';
                this.applyFilters();
                this.render();
            }

            getMetrics() {
                const completedStatuses = this.currentSource === 'freshservice' ? ['Resolved', 'Closed'] : ['Completed'];
                const inProgressStatuses = this.currentSource === 'freshservice' ? ['Open', 'Pending', 'On Hold'] : ['In Progress', 'Not Started'];
                
                const highPriorityOpenStatuses = this.currentSource === 'freshservice' 
                    ? this.filteredData.filter(d => d.Status === 'Open' && d.Priority === 'High') 
                    : [];
                
                const completed = this.filteredData.filter(d => completedStatuses.includes(d.Status)).length;
                const inProgress = this.filteredData.filter(d => inProgressStatuses.includes(d.Status)).length;
                const blocked = this.currentSource === 'tracker' 
                    ? this.filteredData.filter(d => d.Status === 'Blocked').length
                    : highPriorityOpenStatuses.length;

                const total = this.filteredData.length;

                return {
                    total,
                    completed,
                    inProgress,
                    blocked,
                    completionRate: total > 0 ? Math.round((completed / total) * 100) : 0
                };
            }

            getEngineerStats() {
                const stats = {};
                const completedStatuses = this.currentSource === 'freshservice' ? ['Resolved', 'Closed'] : ['Completed'];
                
                this.filteredData.forEach(item => {
                    const name = this.getFieldValue(item, 'engineer');
                    if (!name || name === 'Unassigned') return;
                    
                    if (!stats[name]) {
                        stats[name] = { total: 0, completed: 0 };
                    }
                    stats[name].total++;
                    if (completedStatuses.includes(item.Status)) stats[name].completed++;
                });

                return Object.entries(stats)
                    .map(([name, data]) => ({
                        name,
                        ...data,
                        rate: data.total > 0 ? Math.round((data.completed / data.total) * 100) : 0
                    }))
                    .sort((a, b) => b.rate - a.rate);
            }

            exportCSV() {
                // ... same export logic ...
                 let headers, rows;
                const source = this.currentSource;
                if (source === 'freshservice') {
                    headers = ['ID', 'Type', 'Status', 'Priority', 'Subject', 'Agent Name', 'Created Date', 'Resolved Date'];
                    rows = this.filteredData.map(item => [item.ID, item.Type, item.Status, item.Priority, item.Subject, this.getFieldValue(item, 'engineer'), item['Created Date'], item['Resolved Date']]);
                } else { 
                    headers = ['Task', 'Sub-Task', 'Engineer', 'Status', 'Start Date', 'Closure Date', 'Blocker'];
                    rows = this.filteredData.map(item => [
                        item.Task, item['Sub-Task'], this.getFieldValue(item, 'engineer'), item.Status, item['Start Date'], item['Closure Date'], item['Blocker/Dependency']
                    ]);
                }
                const csv = [headers, ...rows].map(row => (row || []).map(cell => `"${cell || ''}"`).join(',')).join('\n');
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `report_${new Date().toISOString().slice(0,10)}.csv`;
                link.click();
            }

            render() {
                this.renderFilters();
                this.renderStats();
                this.renderEngineerCards();
                this.renderTable();
                document.getElementById('recordCount').innerText = `${this.filteredData.length} records found`;
            }

            renderFilters() {
                const engineerList = this.metadata.engineers || [];
                const engineerHTML = engineerList.map(eng => {
                    const isActive = this.filters.engineers.includes(eng);
                    return `
                        <button class="px-3 py-1 text-xs font-medium rounded-full border transition-all duration-200 ${isActive ? 'bg-executive-gold text-executive-950 border-executive-gold' : 'bg-executive-900 text-gray-400 border-executive-800 hover:border-executive-700 hover:text-white'}" onclick="dashboard.toggleEngineerFilter('${eng}')">
                            ${eng}
                        </button>
                    `;
                }).join('');
                document.getElementById('engineerFilters').innerHTML = engineerHTML;

                const statusHTML = (this.metadata.statuses || []).map(status => {
                    const isActive = this.filters.statuses.includes(status);
                    return `
                        <button class="px-3 py-1 text-xs font-medium rounded-full border transition-all duration-200 ${isActive ? 'bg-executive-blue text-white border-executive-blue' : 'bg-executive-900 text-gray-400 border-executive-800 hover:border-executive-700 hover:text-white'}" onclick="dashboard.toggleStatusFilter('${status}')">
                            ${status}
                        </button>
                    `;
                }).join('');
                document.getElementById('statusFilters').innerHTML = statusHTML;
            }

            renderStats() {
                const metrics = this.getMetrics();
                const completedLabel = this.currentSource === 'tracker' ? 'Completed Tasks' : 'Resolved/Closed';
                const blockedLabel = this.currentSource === 'tracker' ? 'Blocked Items' : 'High Priority Open';

                const createCard = (label, value, colorClass, subtext) => `
                    <div class="bg-executive-900 border border-executive-800 rounded-xl p-6 relative overflow-hidden group hover:border-executive-700 transition-colors">
                        <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <div class="w-16 h-16 rounded-full bg-${colorClass} blur-xl"></div>
                        </div>
                        <div class="relative z-10">
                            <div class="text-4xl font-bold text-white mb-1 tracking-tighter">${value}</div>
                            <div class="text-xs font-semibold uppercase tracking-wider text-gray-500">${label}</div>
                            ${subtext ? `<div class="mt-2 text-xs text-${colorClass}">${subtext}</div>` : ''}
                        </div>
                    </div>
                `;

                const html = `
                    ${createCard('Total Volume', metrics.total, 'gray-400')}
                    ${createCard(completedLabel, metrics.completed, 'executive-green', `${metrics.completionRate}% Efficiency`)}
                    ${createCard('Active / In Progress', metrics.inProgress, 'executive-blue')}
                    ${createCard(blockedLabel, metrics.blocked, 'executive-red', 'Requires Attention')}
                `;
                document.getElementById('statsGrid').innerHTML = html;
            }

            renderEngineerCards() {
                const engineers = this.getEngineerStats();
                const cardSubtitleText = this.currentSource === 'tracker' ? 'tasks done' : 'tickets resolved';
                
                const cardsHTML = engineers.map(eng => `
                    <div class="bg-executive-900 border border-executive-800 rounded-xl p-6 hover:shadow-lg hover:border-executive-700 transition-all duration-300">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="text-lg font-bold text-white">${eng.name}</h4>
                                <p class="text-xs text-gray-500 uppercase tracking-wide mt-1">${eng.completed} / ${eng.total} ${cardSubtitleText}</p>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-executive-950 border border-executive-800 flex items-center justify-center text-xs font-bold text-gray-300">
                                ${eng.name.charAt(0)}
                            </div>
                        </div>
                        
                        <div class="relative pt-1">
                            <div class="flex mb-2 items-center justify-between">
                                <div class="text-right">
                                    <span class="text-xs font-semibold inline-block text-${eng.rate > 75 ? 'executive-green' : (eng.rate > 40 ? 'executive-blue' : 'executive-gold')}">
                                        ${eng.rate}% Success
                                    </span>
                                </div>
                            </div>
                            <div class="overflow-hidden h-2 mb-4 text-xs flex rounded-full bg-executive-950 border border-executive-800">
                                <div style="width:${eng.rate}%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center ${eng.rate > 75 ? 'bg-executive-green' : (eng.rate > 40 ? 'bg-executive-blue' : 'bg-executive-gold')} transition-all duration-1000 ease-out"></div>
                            </div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('engineerCards').innerHTML = cardsHTML || '<div class="col-span-3 text-center text-gray-500 py-10 italic">No performance data available for current filters.</div>';
            }

            renderTable() {
                if (this.filteredData.length === 0) {
                    document.getElementById('tableContent').innerHTML = `
                        <div class="p-12 text-center">
                            <div class="text-4xl mb-4">üì≠</div>
                            <h3 class="text-white font-medium mb-1">No Records Found</h3>
                            <p class="text-gray-500 text-sm">Adjust filters or switch data sources.</p>
                        </div>
                    `;
                    return;
                }

                const getStatusBadge = (status) => {
                    const s = status.toLowerCase();
                    let color = 'bg-gray-800 text-gray-300 border-gray-700';
                    if (['completed', 'resolved', 'closed'].some(x => s.includes(x))) color = 'bg-green-900/30 text-green-400 border-green-900';
                    else if (['in progress', 'open', 'pending'].some(x => s.includes(x))) color = 'bg-blue-900/30 text-blue-400 border-blue-900';
                    else if (['blocked', 'high'].some(x => s.includes(x))) color = 'bg-red-900/30 text-red-400 border-red-900';
                    else if (['on hold'].some(x => s.includes(x))) color = 'bg-yellow-900/30 text-yellow-400 border-yellow-900';
                    
                    return `<span class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider border ${color}">${status}</span>`;
                };

                let tableHeader, tableRows;
                
                if (this.currentSource === 'freshservice') {
                    tableHeader = `
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Reference</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Agent</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Created</th>
                    `;
                    tableRows = this.filteredData.map(item => `
                        <tr class="border-b border-executive-800 hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4">
                                <div class="text-sm font-bold text-white">#${item.ID || '?'}</div>
                                <div class="text-xs text-gray-500 truncate max-w-xs">${item.Subject || 'No Subject'}</div>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-300">${this.getFieldValue(item, 'engineer')}</td>
                            <td class="px-6 py-4">${getStatusBadge(item.Status)}</td>
                            <td class="px-6 py-4 text-xs text-gray-500 font-mono">${item['Created Date'] || '-'}</td>
                        </tr>
                    `).join('');
                } else {
                    tableHeader = `
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Task</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Engineer</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider">Timeline</th>
                    `;
                    tableRows = this.filteredData.map(item => `
                        <tr class="border-b border-executive-800 hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4">
                                <div class="text-sm font-bold text-white">${item.Task}</div>
                                <div class="text-xs text-gray-500">${item['Sub-Task'] || ''}</div>
                                ${item['Blocker/Dependency'] ? `<div class="mt-1 text-[10px] text-red-400">‚ö†Ô∏è ${item['Blocker/Dependency']}</div>` : ''}
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-300">${this.getFieldValue(item, 'engineer')}</td>
                            <td class="px-6 py-4">${getStatusBadge(item.Status)}</td>
                            <td class="px-6 py-4 text-xs text-gray-500 font-mono">
                                <div>Start: ${item['Start Date']}</div>
                                ${item['Closure Date'] ? `<div>End: ${item['Closure Date']}</div>` : ''}
                            </td>
                        </tr>
                    `).join('');
                }

                document.getElementById('tableContent').innerHTML = `
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-executive-950 border-b border-executive-800">
                            <tr>${tableHeader}</tr>
                        </thead>
                        <tbody class="divide-y divide-executive-800">
                            ${tableRows}
                        </tbody>
                    </table>
                `;
            }
        }

        let dashboard;
        window.addEventListener('DOMContentLoaded', () => {
            dashboard = new Dashboard();
            
            // Event Listeners for Filters
            document.getElementById('refreshBtn').addEventListener('click', () => dashboard.loadData());
            document.getElementById('exportBtn').addEventListener('click', () => dashboard.exportCSV());
            
            const handleDateChange = () => {
                dashboard.filters.dateRange.start = document.getElementById('startDate').value;
                dashboard.filters.dateRange.end = document.getElementById('endDate').value;
                dashboard.applyFilters();
                dashboard.render();
            };
            
            document.getElementById('startDate').addEventListener('change', handleDateChange);
            document.getElementById('endDate').addEventListener('change', handleDateChange);
        });
    </script>
</body>
</html>
